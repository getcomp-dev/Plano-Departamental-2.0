{"version":3,"sources":["webpack:///./src/pages/gerenciar/DisciplinasGrades/ModalImportacao.vue","webpack:///src/pages/gerenciar/DisciplinasGrades/ModalImportacao.vue","webpack:///./src/pages/gerenciar/DisciplinasGrades/ModalImportacao.vue?1808","webpack:///./src/pages/gerenciar/DisciplinasGrades/ModalImportacao.vue?7db0"],"names":["render","_vm","this","_c","_self","ref","attrs","scopedSlots","_u","key","fn","staticClass","on","handleSelectCurso","model","value","cursoSelecionado","callback","$$v","expression","_l","cursosDCCOrdered","curso","codigo","nome","hasCursoSelected","gradeSelecionada","gradesCursoSelecionado","grade","id","_v","fileImportacao","proxy","handleImport","staticRenderFns","components","VInputFile","VSelect","VOption","data","methods","mapActions","parseCSVFileToArray","disciplinasGrades","validateDisciplinasGrades","finalValue","disciplinasGradeSelecionada","discGrade","type","text","title","handleCreateDisciplinasNaGrade","disciplinaGrade","discsGradeSelecionada","objDiscGrade","periodo","Disciplina","disciplina","Grade","obrigatoria","createDisciplinasGrade","temDisciplina","disciplinaGradeService","checkDiscGradeExiste","open","close","getIdDisciplina","codigoDisc","disciplinaFound","idDisciplina","computed","mapGetters","component"],"mappings":"uHAAA,IAAIA,EAAS,WAAkB,IAAIC,EAAIC,KAAKC,EAAGF,EAAIG,MAAMD,GAAG,OAAOA,EAAG,YAAY,CAACE,IAAI,2BAA2BC,MAAM,CAAC,MAAQ,qCAAqC,YAAa,EAAK,WAAY,GAAMC,YAAYN,EAAIO,GAAG,CAAC,CAACC,IAAI,aAAaC,GAAG,WAAW,MAAO,CAACP,EAAG,MAAM,CAACQ,YAAY,OAAO,CAACR,EAAG,UAAU,CAACQ,YAAY,QAAQL,MAAM,CAAC,MAAQ,SAASM,GAAG,CAAC,OAASX,EAAIY,mBAAmBC,MAAM,CAACC,MAAOd,EAAIe,iBAAkBC,SAAS,SAAUC,GAAMjB,EAAIe,iBAAiBE,GAAKC,WAAW,qBAAqBlB,EAAImB,GAAInB,EAAIoB,kBAAkB,SAASC,GAAO,OAAOnB,EAAG,UAAU,CAACM,IAAIa,EAAMC,OAAOjB,MAAM,CAAC,MAAQgB,EAAM,KAAOA,EAAME,WAAU,GAAGrB,EAAG,UAAU,CAACQ,YAAY,QAAQL,MAAM,CAAC,MAAQ,QAAQ,UAAYL,EAAIwB,kBAAkBX,MAAM,CAACC,MAAOd,EAAIyB,iBAAkBT,SAAS,SAAUC,GAAMjB,EAAIyB,iBAAiBR,GAAKC,WAAW,qBAAqB,CAAGlB,EAAIwB,iBAA4ExB,EAAImB,GAAInB,EAAI0B,wBAAwB,SAASC,GAAO,OAAOzB,EAAG,UAAU,CAACM,IAAImB,EAAMC,GAAGvB,MAAM,CAAC,MAAQsB,EAAM,KAAOA,EAAMJ,WAAlLrB,EAAG,UAAU,CAACG,MAAM,CAAC,KAAO,+BAAiK,IAAI,GAAGH,EAAG,IAAI,CAACQ,YAAY,8BAA8B,CAACV,EAAI6B,GAAG,qGAAqG3B,EAAG,MAAMF,EAAI6B,GAAG,oEAAoE3B,EAAG,MAAM,CAACQ,YAAY,OAAO,CAACR,EAAG,aAAa,CAACG,MAAM,CAAC,MAAQ,sBAAsB,OAAS,QAAQQ,MAAM,CAACC,MAAOd,EAAI8B,eAAgBd,SAAS,SAAUC,GAAMjB,EAAI8B,eAAeb,GAAKC,WAAW,qBAAqB,KAAKa,OAAM,GAAM,CAACvB,IAAI,eAAeC,GAAG,WAAW,MAAO,CAACP,EAAG,aAAa,CAACQ,YAAY,eAAeL,MAAM,CAAC,KAAO,KAAK,MAAQ,SAASM,GAAG,CAAC,MAAQX,EAAIgC,kBAAkBD,OAAM,QAErqDE,EAAkB,G,uyDCqDP,OACfC,YAAAC,kBAAAC,eAAAC,gBACAC,KAFA,WAGA,OACAR,oBAEAf,sBACAW,4BACAD,wBAIAc,eACAC,gBACA,wBACA,oBACA,oBACA,4BALA,IAOAR,aAPA,qMASAS,oCATA,OASAC,EATA,OAUAC,kBAEA,4BACAC,sBAGAC,EAAA,GAEA,4CACA,8CAnBA,IAsBAH,GAtBA,IAsBA,2BAAAI,UACA,yCAvBA,8BA0BA,uBACAC,eACAC,sCA5BA,qDA+BA,uBACAD,aACAE,iDACAD,oBAlCA,yBAqCA,aArCA,UAsCA,yBAtCA,oJAyCAE,+BAzCA,oEAyCAC,EAAAC,GAzCA,0FA0CA,YA1CA,oDA4CAC,EAAA,CACAC,aACAC,gBACAC,gBACAC,WACAC,gBAGAL,iCACA,4BACAA,qBAEAA,4CACAA,gDACAA,6BAEA,+BA5DA,kCA6DA,iCA7DA,4GA+DAM,uBA/DA,oEA+DAR,EAAAN,GA/DA,0FAgEAe,EAAA,gCAEAA,EAlEA,gCAmEAC,cACAV,aACAA,QACAA,GAtEA,6CAwEAU,iBAxEA,OA0EA,yBA1EA,2GA4EAC,qBA5EA,SA4EAX,EAAAN,GAAA,IAAI,EAAJ,IACAA,GADA,IACA,0CACA,yCAFA,8BAIA,UAEAkB,KAlFA,WAmFA,4CAEAC,MArFA,WAsFA,6CAEApD,kBAxFA,WAwFA,WACA,+DACA,0CAGAqD,gBA7FA,SA6FAC,GAAA,IAAI,EAAJ,IACA,qBADA,IACA,sEADA,gCAGAC,gBAhGA,SAgGAC,GACA,mEAIAC,gBACAC,0FADA,IAEA9C,iBAFA,WAGA,8BAEAJ,iBALA,WAMA,2DC9KuX,I,YCOnXmD,EAAY,eACd,EACAxE,EACAkC,GACA,EACA,KACA,KACA,MAIa,aAAAsC,E","file":"js/chunk-2d21764f.6aeda188.js","sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('BaseModal',{ref:\"BaseModalDisciplinaGrade\",attrs:{\"title\":\"Importação de Disciplinas na Grade\",\"hasOverlay\":true,\"hasFooter\":true},scopedSlots:_vm._u([{key:\"modal-body\",fn:function(){return [_c('div',{staticClass:\"row\"},[_c('VSelect',{staticClass:\"col-7\",attrs:{\"label\":\"Curso\"},on:{\"change\":_vm.handleSelectCurso},model:{value:(_vm.cursoSelecionado),callback:function ($$v) {_vm.cursoSelecionado=$$v},expression:\"cursoSelecionado\"}},_vm._l((_vm.cursosDCCOrdered),function(curso){return _c('VOption',{key:curso.codigo,attrs:{\"value\":curso,\"text\":curso.nome}})}),1),_c('VSelect',{staticClass:\"col-5\",attrs:{\"label\":\"Grade\",\"disabled\":!_vm.hasCursoSelected},model:{value:(_vm.gradeSelecionada),callback:function ($$v) {_vm.gradeSelecionada=$$v},expression:\"gradeSelecionada\"}},[(!_vm.hasCursoSelected)?_c('VOption',{attrs:{\"text\":\"Nenhuma grade encontrada\"}}):_vm._l((_vm.gradesCursoSelecionado),function(grade){return _c('VOption',{key:grade.id,attrs:{\"value\":grade,\"text\":grade.nome}})})],2)],1),_c('p',{staticClass:\"alert alert-secondary my-2\"},[_vm._v(\"\\n      Selecione o curso e a sua grade acima e o arquivo a ser importado. O arquivo deve\\n      \"),_c('br'),_vm._v(\"\\n      ser importado de acordo com a grade selecionada.\\n    \")]),_c('div',{staticClass:\"col\"},[_c('VInputFile',{attrs:{\"label\":\"Selecione o arquivo\",\"accept\":\".csv\"},model:{value:(_vm.fileImportacao),callback:function ($$v) {_vm.fileImportacao=$$v},expression:\"fileImportacao\"}})],1)]},proxy:true},{key:\"modal-footer\",fn:function(){return [_c('BaseButton',{staticClass:\"px-3 ml-auto\",attrs:{\"text\":\"OK\",\"color\":\"green\"},on:{\"click\":_vm.handleImport}})]},proxy:true}])})\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <BaseModal\r\n    ref=\"BaseModalDisciplinaGrade\"\r\n    title=\"Importação de Disciplinas na Grade\"\r\n    :hasOverlay=\"true\"\r\n    :hasFooter=\"true\"\r\n  >\r\n    <template #modal-body>\r\n      <div class=\"row\">\r\n        <VSelect label=\"Curso\" v-model=\"cursoSelecionado\" class=\"col-7\" @change=\"handleSelectCurso\">\r\n          <VOption\r\n            v-for=\"curso in cursosDCCOrdered\"\r\n            :key=\"curso.codigo\"\r\n            :value=\"curso\"\r\n            :text=\"curso.nome\"\r\n          />\r\n        </VSelect>\r\n        <VSelect\r\n          label=\"Grade\"\r\n          v-model=\"gradeSelecionada\"\r\n          class=\"col-5\"\r\n          :disabled=\"!hasCursoSelected\"\r\n        >\r\n          <VOption v-if=\"!hasCursoSelected\" text=\"Nenhuma grade encontrada\" />\r\n          <VOption\r\n            v-else\r\n            v-for=\"grade in gradesCursoSelecionado\"\r\n            :key=\"grade.id\"\r\n            :value=\"grade\"\r\n            :text=\"grade.nome\"\r\n          />\r\n        </VSelect>\r\n      </div>\r\n      <p class=\"alert alert-secondary my-2\">\r\n        Selecione o curso e a sua grade acima e o arquivo a ser importado. O arquivo deve\r\n        <br />\r\n        ser importado de acordo com a grade selecionada.\r\n      </p>\r\n      <div class=\"col\">\r\n        <VInputFile label=\"Selecione o arquivo\" v-model=\"fileImportacao\" accept=\".csv\" />\r\n      </div>\r\n    </template>\r\n    <template #modal-footer>\r\n      <BaseButton text=\"OK\" color=\"green\" class=\"px-3 ml-auto\" @click=\"handleImport\" />\r\n    </template>\r\n  </BaseModal>\r\n</template>\r\n\r\n<script>\r\nimport { VInputFile, VSelect, VOption } from \"@/components/ui\";\r\nimport { parseCSVFileToArray, validateDisciplinasGrades } from \"@/common/utils\";\r\nimport { mapActions, mapGetters } from \"vuex\";\r\nimport disciplinaGradeService from \"@/services/disciplinaGrade\";\r\nimport { orderBy } from \"lodash-es\";\r\n\r\nexport default {\r\n  components: { VInputFile, VSelect, VOption },\r\n  data() {\r\n    return {\r\n      fileImportacao: null,\r\n\r\n      cursoSelecionado: null,\r\n      gradesCursoSelecionado: null,\r\n      gradeSelecionada: null,\r\n    };\r\n  },\r\n\r\n  methods: {\r\n    ...mapActions([\r\n      \"initializeProgressBar\",\r\n      \"updateProgressBar\",\r\n      \"finishProgressBar\",\r\n      \"createDisciplinasGrade\",\r\n    ]),\r\n    async handleImport() {\r\n      try {\r\n        const disciplinasGrades = await parseCSVFileToArray(this.fileImportacao);\r\n        validateDisciplinasGrades(disciplinasGrades);\r\n\r\n        this.initializeProgressBar({\r\n          finalValue: disciplinasGrades.length,\r\n        });\r\n\r\n        const disciplinasGradeSelecionada = [];\r\n\r\n        this.DisciplinasGrades.forEach((disc) => {\r\n          if (disc.Grade === this.gradeSelecionada.id) disciplinasGradeSelecionada.push(disc);\r\n        });\r\n\r\n        for (const discGrade of disciplinasGrades) {\r\n          this.handleCreateDisciplinasNaGrade(discGrade, disciplinasGradeSelecionada);\r\n        }\r\n\r\n        this.pushNotification({\r\n          type: \"success\",\r\n          text: \"Disciplinas criadas na Grade\",\r\n        });\r\n      } catch (error) {\r\n        this.pushNotification({\r\n          type: \"error\",\r\n          title: \"Erro ao importar disciplinas nas grades!\",\r\n          text: error.message,\r\n        });\r\n      } finally {\r\n        this.close(); // O modal fecha de qualquer jeito por causa do esc\r\n        await this.finishProgressBar();\r\n      }\r\n    },\r\n    async handleCreateDisciplinasNaGrade(disciplinaGrade, discsGradeSelecionada) {\r\n      if (!disciplinaGrade || !discsGradeSelecionada.length) return;\r\n\r\n      let objDiscGrade = {\r\n        periodo: null,\r\n        Disciplina: null,\r\n        disciplina: null,\r\n        Grade: null,\r\n        obrigatoria: false,\r\n      };\r\n\r\n      objDiscGrade.Grade = this.gradeSelecionada.id;\r\n      if (disciplinaGrade.PERIODO == \"-\") objDiscGrade.periodo = 15;\r\n      else objDiscGrade.periodo = +disciplinaGrade.PERIODO;\r\n\r\n      objDiscGrade.Disciplina = this.getIdDisciplina(disciplinaGrade.CODIGO);\r\n      objDiscGrade.disciplina = this.disciplinaFound(objDiscGrade.Disciplina);\r\n      objDiscGrade.obrigatoria = +disciplinaGrade.OBRIGATORIA;\r\n\r\n      if (typeof objDiscGrade.Disciplina === \"number\")\r\n        await this.createDisciplinasGrade(objDiscGrade, discsGradeSelecionada);\r\n    },\r\n    async createDisciplinasGrade(disciplinaGrade, disciplinasGradeSelecionada) {\r\n      const temDisciplina = this.checkDiscGradeExiste(disciplinaGrade, disciplinasGradeSelecionada);\r\n\r\n      if (temDisciplina)\r\n        await disciplinaGradeService.update(\r\n          disciplinaGrade.Disciplina,\r\n          disciplinaGrade.Grade,\r\n          disciplinaGrade\r\n        );\r\n      else await disciplinaGradeService.create(disciplinaGrade);\r\n\r\n      this.updateProgressBar();\r\n    },\r\n    checkDiscGradeExiste(disciplinaGrade, disciplinasGradeSelecionada) {\r\n      for (const disc of disciplinasGradeSelecionada) {\r\n        if (disciplinaGrade.Disciplina === disc.Disciplina) return true;\r\n      }\r\n      return false;\r\n    },\r\n    open() {\r\n      this.$refs.BaseModalDisciplinaGrade.open();\r\n    },\r\n    close() {\r\n      this.$refs.BaseModalDisciplinaGrade.close();\r\n    },\r\n    handleSelectCurso() {\r\n      this.gradesCursoSelecionado = this.AllGrades.filter((grade) => {\r\n        return grade.Curso == this.cursoSelecionado.id;\r\n      });\r\n    },\r\n    getIdDisciplina(codigoDisc) {\r\n      for (const disc of this.AllDisciplinas) if (disc.codigo == codigoDisc) return disc.id;\r\n    },\r\n    disciplinaFound(idDisciplina) {\r\n      return this.AllDisciplinas.find((disciplina) => disciplina.id === idDisciplina);\r\n    },\r\n  },\r\n\r\n  computed: {\r\n    ...mapGetters([\"PrincipaisCursosDCC\", \"AllDisciplinas\", \"AllGrades\", \"DisciplinasGrades\"]),\r\n    hasCursoSelected() {\r\n      return this.cursoSelecionado;\r\n    },\r\n    cursosDCCOrdered() {\r\n      return orderBy(this.PrincipaisCursosDCC, \"name\");\r\n    },\r\n  },\r\n};\r\n</script>\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ModalImportacao.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ModalImportacao.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ModalImportacao.vue?vue&type=template&id=45a44f77&\"\nimport script from \"./ModalImportacao.vue?vue&type=script&lang=js&\"\nexport * from \"./ModalImportacao.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}