{"version":3,"sources":["webpack:///./src/pages/gerenciar/Planos/ModalImportPedidos/index.vue?bcd2","webpack:///./src/pages/gerenciar/Planos/ModalImportPedidos/index.vue?a0e6","webpack:///src/pages/gerenciar/Planos/ModalImportPedidos/index.vue","webpack:///./src/pages/gerenciar/Planos/ModalImportPedidos/index.vue?79d1","webpack:///./src/pages/gerenciar/Planos/ModalImportPedidos/index.vue?bbdb"],"names":["render","_vm","this","_h","$createElement","_c","_self","ref","attrs","scopedSlots","_u","key","fn","staticClass","_v","_s","planoForm","nome","ano","proxy","on","handleImportPedidosOferecidos","staticRenderFns","name","props","data","abortImport","mounted","document","addEventListener","onEscAbortImport","beforeDestroy","removeEventListener","methods","open","$refs","baseModalImportPedidos","close","event","stopPropagation","code","pedidosAreEqual","pedido1","Curso","pedido2","Turma","computed","component"],"mappings":"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","file":"js/chunk-e33ab9a4.e1f3c412.js","sourcesContent":["export * from \"-!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/index.js??ref--8-oneOf-1-1!../../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&lang=scss&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('BaseModal',{ref:\"baseModalImportPedidos\",attrs:{\"title\":\"Importar pedidos\",\"hasOverlay\":true,\"hasFooter\":true,\"classes\":\"modal-import-pedidos\"},scopedSlots:_vm._u([{key:\"modal-body\",fn:function(){return [_c('p',{staticClass:\"alert alert-secondary\"},[_vm._v(\"\\n      Selecione arquivos\\n      \"),_c('b',[_vm._v(\".csv\")]),_vm._v(\"\\n      para importar os pedidos oferecidos e ocupados de cada período no plano\\n      \"),_c('b',[_vm._v(_vm._s(_vm.planoForm.nome)+\" - \"+_vm._s(_vm.planoForm.ano)+\".\")]),_c('br'),_vm._v(\"\\n      Note que o formato do arquivo requerido é o relatório de plano departamental gerado pelo\\n      \"),_c('a',{attrs:{\"href\":\"https://siga.ufjf.br\",\"target\":\"_blank\"}},[_vm._v(\"SIGA\")]),_vm._v(\"\\n      na página:\\n      \"),_c('b',[_vm._v(\"Acadêmico > Consultas > Plano Departamental.\")]),_vm._v(\"\\n      E você pode cancelar o processo durante a importação apertando a tecla esc.\\n    \")]),_c('div',{staticClass:\"row mb-2 mx-0\"},[_c('div',{staticClass:\"form-group col m-0 p-0\"},[_c('label',{attrs:{\"for\":\"inputPedidos\"}},[_vm._v(\"Primeiro periodo:\")]),_c('input',{ref:\"input1periodo\",staticClass:\"w-100 form-control-file mt-1\",attrs:{\"id\":\"inputPedidos\",\"type\":\"file\",\"accept\":\".csv\"}})])]),_c('div',{staticClass:\"row mb-2 mx-0\"},[_c('div',{staticClass:\"form-group col m-0 p-0\"},[_c('label',{attrs:{\"for\":\"inputPedidos\"}},[_vm._v(\"Terceiro periodo:\")]),_c('input',{ref:\"input3periodo\",staticClass:\"w-100 form-control-file mt-1\",attrs:{\"id\":\"inputPedidos\",\"type\":\"file\",\"accept\":\".csv\"}})])])]},proxy:true},{key:\"modal-footer\",fn:function(){return [_c('BaseButton',{staticClass:\"px-3 ml-auto\",attrs:{\"text\":\"Confirmar\",\"color\":\"blue\"},on:{\"click\":_vm.handleImportPedidosOferecidos}})]},proxy:true}])})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <BaseModal\r\n    ref=\"baseModalImportPedidos\"\r\n    title=\"Importar pedidos\"\r\n    :hasOverlay=\"true\"\r\n    :hasFooter=\"true\"\r\n    classes=\"modal-import-pedidos\"\r\n  >\r\n    <template #modal-body>\r\n      <p class=\"alert alert-secondary\">\r\n        Selecione arquivos\r\n        <b>.csv</b>\r\n        para importar os pedidos oferecidos e ocupados de cada período no plano\r\n        <b>{{ planoForm.nome }} - {{ planoForm.ano }}.</b>\r\n        <br />\r\n        Note que o formato do arquivo requerido é o relatório de plano departamental gerado pelo\r\n        <a href=\"https://siga.ufjf.br\" target=\"_blank\">SIGA</a>\r\n        na página:\r\n        <b>Acadêmico > Consultas > Plano Departamental.</b>\r\n        E você pode cancelar o processo durante a importação apertando a tecla esc.\r\n      </p>\r\n\r\n      <div class=\"row mb-2 mx-0\">\r\n        <div class=\"form-group col m-0 p-0\">\r\n          <label for=\"inputPedidos\">Primeiro periodo:</label>\r\n          <input\r\n            id=\"inputPedidos\"\r\n            type=\"file\"\r\n            ref=\"input1periodo\"\r\n            class=\"w-100 form-control-file mt-1\"\r\n            accept=\".csv\"\r\n          />\r\n        </div>\r\n      </div>\r\n      <div class=\"row mb-2 mx-0\">\r\n        <div class=\"form-group col m-0 p-0\">\r\n          <label for=\"inputPedidos\">Terceiro periodo:</label>\r\n          <input\r\n            id=\"inputPedidos\"\r\n            type=\"file\"\r\n            ref=\"input3periodo\"\r\n            class=\"w-100 form-control-file mt-1\"\r\n            accept=\".csv\"\r\n          />\r\n        </div>\r\n      </div>\r\n    </template>\r\n\r\n    <template #modal-footer>\r\n      <BaseButton\r\n        text=\"Confirmar\"\r\n        color=\"blue\"\r\n        class=\"px-3 ml-auto\"\r\n        @click=\"handleImportPedidosOferecidos\"\r\n      />\r\n    </template>\r\n  </BaseModal>\r\n</template>\r\n\r\n<script>\r\nimport { mapActions, mapGetters } from \"vuex\";\r\nimport turmaService from \"@/services/turma\";\r\nimport { parseCSVFileToArray } from \"@/common/utils\";\r\nimport {\r\n  parseTurmaSIGAToPedido,\r\n  getKeysTurmaSIGA,\r\n  validateTurmasSIGA,\r\n} from \"@/common/utils/turmasSIGA\";\r\n\r\nexport default {\r\n  name: \"ModalNovoPlano\",\r\n  props: {\r\n    planoForm: { type: Object, required: true },\r\n  },\r\n  data() {\r\n    return {\r\n      abortImport: false,\r\n    };\r\n  },\r\n  mounted() {\r\n    document.addEventListener(\"keydown\", this.onEscAbortImport);\r\n  },\r\n  beforeDestroy() {\r\n    document.removeEventListener(\"keydown\", this.onEscAbortImport);\r\n  },\r\n\r\n  methods: {\r\n    ...mapActions([\r\n      \"createPedidoOferecido\",\r\n      \"updatePedidoOferecido\",\r\n      \"initializeProgressBar\",\r\n      \"updateProgressBar\",\r\n      \"finishProgressBar\",\r\n    ]),\r\n\r\n    open() {\r\n      this.$refs.baseModalImportPedidos.open();\r\n    },\r\n    close() {\r\n      this.$refs.baseModalImportPedidos.close();\r\n    },\r\n    onEscAbortImport(event) {\r\n      event.stopPropagation();\r\n      if (event.code === \"Escape\") this.abortImport = true;\r\n    },\r\n    async handleImportPedidosOferecidos() {\r\n      const [file1Periodo] = this.$refs.input1periodo.files;\r\n      const [file3Periodo] = this.$refs.input3periodo.files;\r\n      if (!file1Periodo && !file3Periodo) {\r\n        this.pushNotification({\r\n          type: \"error\",\r\n          text: \"Nenhum arquivo selecionado\",\r\n        });\r\n        return;\r\n      }\r\n\r\n      try {\r\n        this.abortImport = false;\r\n        const turmasFile1Periodo = await parseCSVFileToArray(file1Periodo);\r\n        const turmasFile3Periodo = await parseCSVFileToArray(file3Periodo);\r\n        validateTurmasSIGA(turmasFile1Periodo);\r\n        validateTurmasSIGA(turmasFile3Periodo);\r\n\r\n        this.initializeProgressBar({\r\n          finalValue: turmasFile1Periodo.length + turmasFile3Periodo.length,\r\n        });\r\n\r\n        let turmasDoPlano;\r\n        if (this.planoForm.id === this.currentPlano.id) {\r\n          turmasDoPlano = [...this.AllTurmas];\r\n        } else {\r\n          const { Turmas = [] } = await turmaService.fetchAll(this.planoForm.id);\r\n          turmasDoPlano = Turmas;\r\n        }\r\n        if (!turmasDoPlano.length) {\r\n          this.pushNotification({\r\n            type: \"error\",\r\n            text: \"Plano selecionado não possui turmas\",\r\n          });\r\n          return;\r\n        }\r\n\r\n        await this.createPedidosFileSIGA(turmasFile1Periodo, turmasDoPlano, 1);\r\n        await this.createPedidosFileSIGA(turmasFile3Periodo, turmasDoPlano, 3);\r\n\r\n        if (!this.abortImport) {\r\n          this.close();\r\n          this.pushNotification({\r\n            type: \"success\",\r\n            text: `Pedidos importados para o plano ${this.currentPlano.nome}`,\r\n          });\r\n        } else {\r\n          this.pushNotification({\r\n            type: \"warn\",\r\n            text: \"Importação dos pedidos foi cancelada!\",\r\n          });\r\n        }\r\n      } catch (error) {\r\n        this.pushNotification({\r\n          type: \"error\",\r\n          title: \"Erro ao importar pedidos!\",\r\n        });\r\n      } finally {\r\n        await this.finishProgressBar();\r\n      }\r\n    },\r\n    async createPedidosFileSIGA(turmasSIGA, turmasDoPlano, periodo) {\r\n      if (!turmasSIGA.length || !turmasDoPlano.length) return;\r\n\r\n      let currentPedido = {};\r\n      const keysTurmaSIGA = getKeysTurmaSIGA(turmasSIGA[0]);\r\n\r\n      for (const turmaSIGA of turmasSIGA) {\r\n        if (this.abortImport) break;\r\n        this.updateProgressBar();\r\n\r\n        const turmaDoPlanoFound = turmasDoPlano.find(\r\n          (turma) =>\r\n            turma.periodo === periodo &&\r\n            turma.disciplina.codigo === turmaSIGA[keysTurmaSIGA.disciplinaCod] &&\r\n            turma.letra === turmaSIGA[keysTurmaSIGA.letra]\r\n        );\r\n        if (turmaDoPlanoFound) {\r\n          const pedidoOferecido = parseTurmaSIGAToPedido(\r\n            turmaSIGA,\r\n            keysTurmaSIGA,\r\n            turmaDoPlanoFound.id\r\n          );\r\n          // Se for igual ao currentPedido, não cria pois ja foi criado antes\r\n          if (pedidoOferecido && !this.pedidosAreEqual(pedidoOferecido, currentPedido)) {\r\n            const pedidoCreated = await this.handleCreatePedidoOferecido(pedidoOferecido);\r\n            currentPedido = { ...pedidoCreated };\r\n          }\r\n        }\r\n      }\r\n    },\r\n    async handleCreatePedidoOferecido(pedidoOferecido) {\r\n      try {\r\n        return await this.createPedidoOferecido({ data: pedidoOferecido });\r\n      } catch (error) {\r\n        return await this.updatePedidoOferecido({ data: pedidoOferecido });\r\n      }\r\n    },\r\n    pedidosAreEqual(pedido1, pedido2) {\r\n      return pedido1.Curso === pedido2.Curso && pedido1.Turma === pedido2.Turma;\r\n    },\r\n  },\r\n\r\n  computed: {\r\n    ...mapGetters([\"AllTurmas\"]),\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.modal-import-pedidos {\r\n  font-size: 14px;\r\n\r\n  .form-row {\r\n    margin: 0;\r\n    padding: 0;\r\n    margin-bottom: 1rem;\r\n  }\r\n\r\n  .form-group {\r\n    margin: 0;\r\n    padding: 0;\r\n  }\r\n\r\n  .alert {\r\n    width: 470px;\r\n    margin-bottom: 1rem;\r\n    padding: 8px 10px;\r\n    padding-right: 20px;\r\n    background-color: #e9ecef !important;\r\n    font-size: 12px;\r\n    word-break: break-word;\r\n    border-top-left-radius: 0;\r\n    border-top-right-radius: 0;\r\n  }\r\n\r\n  .form-control {\r\n    width: 100%;\r\n    height: 28px;\r\n    font-size: 12px;\r\n    padding: 0 5px;\r\n    text-align: start;\r\n  }\r\n  label {\r\n    margin: 0;\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/babel-loader/lib/index.js!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/babel-loader/lib/index.js!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=2a782045&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}